<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
	xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/security 
	http://www.springframework.org/schema/security/spring-security.xsd
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-4.3.xsd">

	<!-- 기본서비스 -->
	<http use-expressions="true">
		<intercept-url pattern="/login/loginForm.do"
			access="permitAll" />
		<intercept-url pattern="/home.do" access="permitAll" />
		<intercept-url pattern="/user/**" access="permitAll" />

		<intercept-url pattern="/admin/**"
			access="hasRole('ADMIN')" />
		<intercept-url pattern="/**"
			access="hasAnyRole('USER, ADMIN')" />

		<form-login login-page="/login/loginForm.do"
			default-target-url="/home.do"
			authentication-failure-url="/login/loginForm.do?error"
			username-parameter="id" password-parameter="user_pwd" />

		<logout logout-url="/logout" logout-success-url="/home.do" />

		<access-denied-handler
			error-page="/login/loginDenied.do" />
	</http>

	<beans:bean id="userDetailsService"
		class="org.springframework.security.core.userdetails.jdbc.JdbcDaoImpl">
		<beans:property name="dataSource" ref="dataSource" />
	</beans:bean>

	<!-- BCryptPasswordEncoder 클래스 빈 추가 -->
	<beans:bean id="bcryptPasswordEncoder"
		class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />


	<!-- provider -->
	<authentication-manager>
		<authentication-provider>
			<!-- <user-service> <user name="user" password="password" authorities="ROLE_USER" 
				/> <user name="admin" password="password" authorities="ROLE_ADMIN" /> </user-service> -->
				
			<!-- 로그인 시 비밀번호를 암호화해서 DB에서 조회한 비밀번호와 비교 -->
			<password-encoder ref="bcryptPasswordEncoder" />

			<jdbc-user-service data-source-ref="dataSource"
				role-prefix=""
				users-by-username-query="select id, user_pwd,'1' as enabled from member_tbl where id=?"
				authorities-by-username-query="select id, authority from member_tbl where id=?" />
		</authentication-provider>
	</authentication-manager>


</beans:beans>